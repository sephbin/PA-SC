from django.http import HttpResponse, HttpResponseRedirect, JsonResponse
from django.shortcuts import get_object_or_404, render
from django.template.defaultfilters import slugify
from django.contrib  import messages
from .models import *
# Create your views here.

def home(request):
	return render(request, "schome.html")

def temp(request):
	log = []
	titles = [{"title":"Absent-Mindedness","main":"You have trouble focusing on anything not of immediate interest. You have -5 on all IQ and IQ-based skill rolls, save those for the task you are currently concentrating on. If no engaging task or topic presents itself, your attention will drift to more interesting matters in five minutes, and you will ignore your immediate surroundings until something catches your attention and brings you back. Once adrift in your own thoughts, you must roll against Perception-5 in order to notice any event short of personal physical injury.\n\nYou may attempt to rivet your attention on a boring topic through sheer strength of will. To do so, make a Will-5 roll once every five minutes. \"Boring topics\" include small talk, repetitive manual tasks, guard duty, driving on an empty highway . . .\n\nAbsent-minded individuals also tend to forget trivial tasks (like paying the bills) and items (like car keys and checkbooks). Whenever it becomes important that you have performed such a task or brought such an item, the GM should call for a roll against IQ-2. On a failure, this detail slipped your attention.\n\nExample: An absent-minded detective is in a shootout. He was involved in gunplay earlier in the day, in which he fired four rounds, so the GM calls for an IQ-2 roll. The detective fails the roll, and discovers too late that he forgot to reload his weapon, so his revolver has only two bullets left!\n\nThis is the classic disadvantage for eccentric geniuses.\n","points":" -15 points"}, {"title":"Addiction","main":"You are addicted to a drug, which you must use daily or suffer withdrawal. The value of this disadvantage depends on the cost, effects, and legality of the drug:\n\nCost (per day)\n\nCheap (up to 0.1% of average starting wealth): -5 points.\n\nExpensive (up to 0.5% of average starting wealth): -10 points.\n\nVery expensive (more than 0.5% of average starting wealth): -20 points.\n\nEffects\n\nIncapacitating or hallucinogenic: -10 points.\n\nHighly addictive (-5 on withdrawal roll): -5 points.\n\nTotally addictive (-10 on withdrawal roll): -10 points.\n\nLegality\n\nIllegal: +0 points.\n\nLegal: +5 points.\n\nExamples: Tobacco is cheap, highly addictive, and legal; a chain-smoker has a -5-point Addiction. Heroin is very expensive, incapacitating, totally addictive, and illegal; a heroin addict has a -40-point Addiction.\n\nNon-Chemical Addictions: You can take Addiction to an activity instead of a drug - for instance, telepathic contact or spending time in virtual reality. If this costs money, price the Addiction based on its daily cost. If it is free (e.g., telepathic contact), treat it as \"Cheap\" if it you can do it almost anywhere (telepathic contact with anyone) or as \"Expensive\" if restrictive conditions apply (telepathic contact with one specific person). Such Addictions almost always cause psychological dependency (see Withdrawal, below).\n\nEffects of Drugs\n\nA stimulating drug leaves you feeling energized . . . until it wears off. Then you are depressed and irritable. An incapacitating drug renders you unconscious (or just blissfully, uselessly drowsy) for about two hours. A hallucinogenic drug renders you useless for work or combat, though you might be active and talkative. Some drugs (e.g., tobacco) have none of these effects, while others have unique effects. Side effects are also possible. For detailed rules, see Addictive Drugs (p. 440).\n\nWithdrawal\n\nSometimes, voluntarily or otherwise, you must try to give up your Addiction. Addiction to a drug that causes psychological dependency is a mental disadvantage; withdrawal from such a drug requires a series of Will rolls, and may result in mental problems. Addiction to a drug that induces physiological dependency is a physical disadvantage; withdrawal is a function of your HT, and may cause physical injury. For details, see Drug Withdrawal (p. 440). Should you successfully withdraw from an Addiction, you must immediately buy off this disadvantage.\n\nMinor Addictions\n\nFor an Addiction worth only -5 points, the GM may rule that the expense, stigma, and detrimental long-term effects of use are the whole of the disadvantage, and waive the usual withdrawal rules. This is appropriate for such drugs as tobacco and caffeine. If forced to go without, you must make a Will or HT roll as usual, but the only effects on a failure are general anxiety, irritability, or restlessness. This manifests as a temporary -1 to DX, IQ, self-control rolls, or reaction rolls (GM's choice) - not as insanity or injury. Successive failures prolong the duration of the effects; they do not increase the size of the penalty. If you can make 14 successful rolls in succession, you must buy off your Addiction.\n\nIt is also possible to create a 0- point Addiction using these rules. Such Addictions are always Minor Addictions, and you may take them as -1-point quirks (see Quirks, p. 162).\n","points":" Variable"}, {"title":"Alcoholism","main":"You are an alcohol addict. Alcoholism uses the Addiction rules (above). It is cheap, incapacitating, and usually legal, so it would normally be a -10-point Addiction. But it is also insidious; therefore, it is worth -15 points - or -20 points if it is illegal.\n\nMost of the time, you may confine your drinking to the evenings, and therefore function normally (for game purposes). However, any time you are in the presence of alcohol, you must roll vs. Will to avoid partaking. A failed roll means you go on a \"binge\" lasting 2d hours, followed by a hangover; see Drinking and Intoxication (p. 439). Alcoholics on a binge are characterized by sudden mood swings - from extreme friendliness to extreme hostility - and may attack friends, talk too freely, or make other mistakes.\n\nThe other drawback of Alcoholism is that it is hard to get rid of. Should you manage to \"withdraw,\" you no longer need to drink daily . . . but you must still make a Will+4 roll whenever you are in the presence of alcohol. A failed roll does not reinstate the addiction, but does set off a binge. (Three binges in a week will reinstate the addiction.) Thus, there is no normal way to \"buy off\" this disadvantage.\n\nContinued Alcoholism will steal your abilities. You must roll yearly against HT+2 until you withdraw. Failure means you lose a level from one of your four basic attributes - roll randomly to determine which.\n","points":" -15 or -20 points"}, {"title":"Amnesia","main":"You've lost your memory. You can't remember any of your past life, including your name. This disadvantage comes in two levels:\n\nPartial Amnesia: You, the player, can see your character sheet, but the GM may reserve up to -30 points of your disadvantage allotment for \"secret\" disadvantages of his choosing. You know that you can use certain skills, but have no idea where you learned them. You are likely to have enemies - and possibly friends - that you can't remember. If you turn yourself in to the police, they can perform their standard ID checks . . . but you might turn out to be a wanted criminal. Even if you aren't, finding out your name won't restore your memory! -10 points.\n\nTotal Amnesia: The only traits you can specify during character creation are those you could see in a mirror. The GM assigns everything else - and holds onto your full character sheet until your memory returns! You have no idea of your full abilities. Since the GM knows your quirks and mental traits, and you don't, he will sometimes overrule your statements about what you're doing. He will also make all skill rolls for you, because you have no idea what you can do until you try it! Your IQ-based skill rolls are at -2 unless the GM feels that memory would have no effect at all on the task at hand. -25 points.\n\nYou can only buy off Amnesia if there is some reason why you might recover your memory; e.g., meeting an old friend, reliving some fateful event, or the ever-popular blow to the head. In most cases, the cure will be related to the cause of the memory loss. Particularly twisted GMs might enjoy making the cause in question some form of brainwashing. In this case, one of the hidden disadvantages will probably be an Enemy with sufficient resources to have arranged the brainwashing in the first place.\n","points":" -10 or -25 points"}, {"title":"Bad Back","main":"For whatever reason, your spinal column is in bad shape. During strenuous physical activity, you may \"throw your back\" and suffer crippling pain or further injury. Whenever you make a ST roll, and whenever you roll 17 or 18 on an attack or defense roll in melee combat, or on a roll for an \"athletic\" skill such as Acrobatics, make a HT roll as well.\n\nModifiers: Any modifiers to the success roll for the activity that triggered the HT roll. For a long task that allows the luxury of planning, you can try to minimize the strain on your back; a successful IQ-2 or Physiology+4 roll gives +2 on the HT roll.\n\nOn a failure, you throw your back. Consequences depend on the severity of your case:\n\nMild: You are at -3 DX until you rest or someone helps you; a First Aid- 2 roll will reset your back. You are also at -3 IQ, but during the next second only (for your next turn, in combat). On a critical failure, you are at -5 DX and must make a Will roll to perform any physical action. -15 points.\n\nSevere: The HT roll is at -2. On a failure, DX and IQ are both at -4 until you receive rest or help; you are in constant agony. On a critical failure, you take 1d-3 damage and are at -6 DX and -4 IQ. -25 points. High Pain Threshold (p. 59) halves all DX and IQ penalties (drop fractions), but does not eliminate them completely.\n","points":" -15 or -25 points"}, {"title":"Bad Grip","main":"You have a penalty on tasks that require a firm grip. Each level (maximum three levels) gives -2 with such tasks. This penalty is overall - not per hand. Affected tasks include melee weapon use, climbing, catching things, and anything else the GM deems requires a firm grip (e.g., an Acrobatics roll to catch a trapeze). This disadvantage is mutually exclusive with No Fine Manipulators (p. 145).\n","points":" -5 points/level"}, {"title":"Bad Sight","main":"You have poor vision. This applies to all your visual senses: regular vision, Infravision, Ultravision, etc. You may be nearsighted or farsighted - your choice.\n\nNearsighted: You cannot read small print, computer displays, etc., more than a foot away, or road signs, etc., at more than about 10 yards. You are at -6 to Vision rolls to spot items more than one yard away. When making a melee attack, you are at -2 to skill. When making a ranged attack, double the actual distance to the target when calculating the range modifier. -25 points.\n\nFarsighted: You cannot read text except with great difficulty (triple normal time). You are at -6 to Vision rolls to spot items within one yard, and you have -3 to DX on any close manual task, including close combat. -25 points.\n\n","points":" -25 points","special_limitations":"Special Limitations\n\nMitigator: At TL5+, you can acquire glasses that compensate totally for Bad Sight while they are worn. At TL7+, contact lenses are available. In both cases, remember that accidents can happen . . . and that enemies can deprive you of these items. If you are starting at a tech level in which vision can be corrected, you must take this limitation. -60%.\n"}, {"title":"Bad Smell","main":"You exude an appalling odor that you cannot remove, such as the stench of death and decay. This causes a -2 reaction from most people and animals (although pests or carrion-eating scavengers might be unusually attracted to you!). You can mask the smell with perfumes, but the overpowering amount needed results in the same reaction penalty.\n","points":" -10 points"}, {"title":"Bad Temper","main":"You are not in full control of your emotions. Make a self-control roll in any stressful situation. If you fail, you lose your temper and must insult, attack, or otherwise act against the cause of the stress.\n","points":" -10 points*"}, {"title":"Berserk","main":"You tend to rampage out of control when you or a loved one is harmed, making frenzied attacks against whoever or whatever you see as the cause of the trouble. If you also suffer from Bad Temper (above), any stress may trigger Berserk.\n\nMake a self-control roll any time you suffer damage over 1/4 your HP in the space of one second, and whenever you witness equivalent harm to a loved one. If you fail, you go berserk. You go berserk automatically if you fail a self-control roll for Bad Temper! You may deliberately go berserk by taking the Concentrate maneuver and making a successful Will roll. Once you are berserk, the following rules apply:\n\n* If armed with a hand weapon, you must make an All-Out Attack each turn a foe is in range. If no foe is in range, you must use a Move maneuver to get as close as possible to a foe - and if you can Move and Attack, or end your Move with a slam, you will.\n\n* If the enemy is more than 20 yards away, you may attack with a ranged weapon if you have one, but you may not take the Aim maneuver. If using a gun, you blaze away at your maximum rate of fire until your gun is empty. You cannot reload unless your weapon - and your Fast-Draw skill - lets you reload \"without thought\" (can take no more than one second). Once your gun is empty, you must either draw another gun or charge into melee combat.\n\n* You are immune to stun and shock, and your injuries cause no penalty to your Move score. You make all rolls to remain conscious or alive at +4 to HT. If you don't fail any rolls, you remain alive and madly attacking until you reach -5xHP. Then you fall - dead!\n\n* When you down a foe, you may (if you wish) attempt another self-control roll to see if you snap out of the berserk state. If you fail (or do not roll), you remain berserk and attack the next foe. Treat any friend who attempts to restrain you as a foe! You get to roll again each time you down a foe, and you get one extra roll when no more foes remain. If you are still berserk, you start to attack your friends . . .\n\nOnce you snap out of the berserk state, all your wounds immediately affect you. Roll at normal HT to see whether you remain conscious and alive.\n\nSpecial Enhancements\n\nBattle Rage. You go berserk in any combat situation, regardless of whether you have been injured. To avoid this, you must make a self-control roll when you first enter combat (even a barroom brawl or a boxing match). +50%.\n","points":" -10 points*"},
	{"title":"Vow","main":"You have sworn an oath to do (or not to do) something. Whatever the oath, you take it seriously; if you didn't, it would not be a disadvantage. This trait is especially appropriate for knights, holy men, and fanatics.\n\nThe point value of a Vow should be directly related to the inconvenience it causes you. The GM is the final judge. Some examples:\n\nMinor Vow: Silence during daylight hours; vegetarianism; chastity (yes, for game purposes, this is minor). -5 points.\n\nMajor Vow: Use no edged weapons; keep silence at all times; never sleep indoors; own no more than your horse can carry. -10 points.\n\nGreat Vow: Never refuse any request for aid; always fight with the wrong hand; hunt a given foe until you destroy him; challenge every knight you meet to combat. -15 points.\n\nNote that if you could represent your Vow using another disadvantage, you only get points for one of the two disadvantages (your choice). No one may get points for Vow (Poverty) and Wealth (Dead Broke), Vow (Never kill) and Pacifism (Cannot Kill), etc.\n\nMany Vows end after a specified period of time. You must buy off such a Vow when it ends. Vows for a period of less than a year are frivolous! If you want to end a Vow before its stated time, the GM may exact a penalty; for instance, in a medieval world, you might have to undertake a quest by way of penance.\n","points":" -5 to -15 points"}, {"title":"Vulnerability","main":"You take extra damage from a particular attack form. Whenever this type of attack hits you, the GM applies a special wounding multiplier to damage that penetrates your DR. Regular wounding multipliers (for cutting, impaling, etc.) further multiply the damage.\n\nExample: A werewolf with Vulnerability (Silver x4) is nicked with a silver knife for 1 point of cutting damage. The GM multiplies this by 4 for Vulnerability, giving 4 points of damage, and then multiplies by 1.5 for a cutting attack. The final injury is 6 HP.\n\nPoint value depends on the wounding multiplier and the rarity of the attack:\n\n[[pic]]\n\nUse the categories under Limited Defenses (p. 46) to assess rarity. The GM has the final say on the rarity of a given attack form. You may not take more than two types of Vulnerability without GM permission.\n\nYou cannot have Vulnerability to anything against which you have a specific defense: Resistant, Damage Resistance limited to work only against that attack form, etc. You can have both Vulnerability and Supernatural Durability (p. 89), but this reduces the utility of Supernatural Durability.\n\n","points":" Variable","special_limitations":"Special Limitations\n\nFatigue Only: You are vulnerable to an attack that drains FP instead of HP, or to some form of mundane fatigue loss (e.g., x2 FP from hot weather). -50%.\n"}, {"title":"Weak Bite","main":"Your jaw is not structured to make full use of your strength while biting. Calculate biting damage normally, then apply an extra -2 per die. This trait is common for large herbivores (e.g., horses), uncommon for small herbivores and omnivores, and very rare for carnivores.\n","points":" -2 points"}, {"title":"Weakness","main":"You suffer injury merely by being in the presence of a particular substance or condition (which cannot be a food item or something equally easy to avoid). This injury comes off your HP directly, regardless of your DR or defensive advantages. The more quickly you take damage, the more points your Weakness is worth:\n\n[[pic]]\n\nMultiply the base value to reflect the rarity of the damaging substance or condition: Rare (e.g., exotic radiation or minerals): x1/2.\n\nO c c a s i o n a l (e.g., microwave radiation, intense normal cold, airborne pollen): x1.\n\nCommon (e.g., smoke, nearby magic, horses, loud noises): x2.\n\nVery Common (e.g., sunlight, living plants): x3. Example: An anaerobic organism takes 1d per minute from oxygen. The base value of a Weakness that inflicts 1d per minute is -20 points. Since oxygen is \"Very Common,\" final cost is -60 points.\n\nYou may not take more than two types of Weakness without GM permission.\n\n","points":" Variable","special_limitations":"Special Limitations\n\nFatigue Only: Your Weakness drains FP instead of HP. -50%.\n\nVariable: Your Weakness is sensitive to received intensity. You may specify one relatively common class of barriers that halves the rate at which you take damage (e.g., heavy clothing or sunscreen, for sunlight). On the other hand, intense sources (GM's decision) double the rate at which you suffer harm! -40%.\n"}, {"title":"Weirdness Magnet","main":"Strange and bizarre things happen to you with alarming frequency. You are the one demons stop and chat with. Magic items with disturbing properties find their way to you. The only talking dog on 21st-century Earth comes to you with his problems. Dimensional gates sealed for centuries crack open just so that you can be bathed in the energies released . . . or perhaps the entities on the other side invite you to tea.\n\nNothing lethal happens to you, at least not immediately, and occasionally some weirdness is beneficial. But most of the time it is terribly, terribly inconvenient. People who understand what a Weirdness Magnet is (and that you are one) react to you at -2. The exceptions are parapsychologists, fringe cultists, unhinged conspiracy theorists, and thrill-seekers, who follow you around!\n","points":" -15 points"}, {"title":"Workaholic","main":"You tend to drive yourself past your limits, and find it hard to relax and turn away from your work. You always work at least half again as long as a normal working day. This often results in missed sleep (see Missed Sleep, p. 426). Most people regard you with respect at first (+1 to reaction rolls), but you eventually suffer -1 or -2 to reactions - especially from friends and loved ones who rarely get to spend time with you.\n","points":" -5 points"}, {"title":"Wounded","main":"You have an open wound that will not completely heal, for whatever reason (botched surgery, backfired healing spell, etc.). You are not missing any HP, but your wound serves as a path for infection and toxins, and may complicate new injuries.\n\nA foe who knows about your wound may deliberately target it, at -7 to hit. Such attacks have a wounding multiplier of 1.5 (that is, you take 50% more damage). Blood agents that reach your wound affect you as if carried on a weapon that broke your skin. You must carefully dress your wound each day (requires a First Aid or Physician roll) or get -3 to all HT rolls to resist infection in a plague-ridden area.\n\nAt the GM's option, you may acquire a wound like this in play due to torture, scalping, etc. Certain wounds have other effects; for instance, scalping would cost you a level of appearance.\n","points":" -5 points"}, {"title":"Xenophilia","main":"You are instinctively fascinated and attracted by strangers and aliens, no matter how dangerous or frightening they appear to be. Make a self-control roll whenever you meet someone (or something) like this. If you fail, you assume that this person is interested in interacting with you socially. A xenophile finds himself offering drinks to glaring foreign soldiers, making passes at cute vampires, and shaking tentacles with Things Man Was Not Meant To Know while his companions are pointing weapons or running the other way . . .\n\nAs partial compensation, you get a bonus to Fright Checks when meeting strange creatures\n\n[[pic]]\n\nNPCs with this trait will react to exotic PCs at a similar bonus.\n","points":" -10 points*"}]
	
	for dab in titles:
		try:
			dis = get_object_or_404(DisadvantagePage, title=dab['title'])
			dis.body = dab['main']
			try: dis.points = dab['points']
			except: pass
			try: dis.slug = slugify(dab['title'])
			except: pass
			try: dis.special_limitations = dab['special_limitations']
			except: pass
			dis.save()
			rev = dis.save_revision()
			rev.publish()
			
		except Exception as e:
			log.append(str(e))
			log.append(dab["title"])


	# indexPage = DisadvantageIndexPage.objects.all()[0]
	# print(indexPage)
	# dpage = DisadvantagePage(title='X_TITLE')
	# indexPage.add_child(instance=dpage)
	# rev = dpage.save_revision()
	# rev.publish()
	# print(dir(dpage))
	# dpage.save()
	# print(dpage)

	# pages = DisadvantagePage.objects.all()
	# log.append(dir(pages[0]))
	# for p in pages:
	# 	revision = p.save_revision()
	# 	revision.publish()
	# 	p.save()
	# for t, p in zip(titles, pages):
		# log.append(t)
		# log.append(p.title)
		# p.title = t
		# p.body = "<p>%s</p>"%(t)
		# p.save()
	# for j in jsob:
	# 	newAd = AdvantagePage.objects.filter(title=j["title"])
	# 	for n in newAd:
	# 		log.append(n.title)
	# 		mtext = j["main"].replace("\n","<br/>")
	# 		mtext = "<p>%s</p>" %(mtext)
	# 		log.append(mtext)
	# 		n.body = mtext
	# 		try:
	# 			text = j["points"].replace("\n","<br/>")
	# 			text = "<p>%s</p>" %(text)
	# 			log.append(text)
	# 			n.points = text
	# 		except: log.append("No Points")
	# 		try:
	# 			text = j["special_limitations"].replace("\n","<br/>")
	# 			text = "<p>%s</p>" %(text)
	# 			log.append(text)
	# 			n.special_limitations = text
	# 		except: log.append("No Limits")
	# 		try:
	# 			text = j["special_enhancements"].replace("\n","<br/>")
	# 			text = "<p>%s</p>" %(text)
	# 			log.append(text)
	# 			n.special_enhancements = text
	# 		except: log.append("No Enhancements")
	# 		n.save()

	return JsonResponse({"log":log})


def map(request):
	context = {"polygons":[
	{"coords":[[100, -100], [100, -120], [80, -120], [80, -100]], "color": 'green', "stroke": False, "fillOpacity": 0.8, },
	]}
	return render(request, "home/rpgmacromap.html", context)